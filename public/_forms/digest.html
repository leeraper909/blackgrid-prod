<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Join the BlackGrid Digest</title>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <style>
    :root{
      --bg:#0b0f14;--panel:#0f1621;--text:#e6edf3;--sub:#9aa7b2;
      --accent:#00d1b2;--border:#1f2a37;--focus:#1b9aaa;
      --grid:#0d1723;--grid2:#0a121b
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      display:flex;align-items:center;justify-content:center;padding:24px;position:relative;overflow:hidden;
    }
    /* Ambient cyber grid */
    body::before, body::after{
      content:"";position:absolute;inset:-10%;
      background:
        linear-gradient(transparent 0 98%, rgba(0,209,178,.08) 98%),
        linear-gradient(90deg, transparent 0 98%, rgba(0,209,178,.08) 98%);
      background-size: 32px 32px, 32px 32px;
      pointer-events:none;opacity:.25;filter:blur(.3px);
      animation:gridmove 18s linear infinite;
    }
    body::after{
      background:
        linear-gradient(transparent 0 98%, rgba(0,209,178,.06) 98%),
        linear-gradient(90deg, transparent 0 98%, rgba(0,209,178,.06) 98%);
      animation:gridmove 24s linear infinite reverse;
    }
    @keyframes gridmove{to{transform:translate3d(-32px,-32px,0)}}
    @media (prefers-reduced-motion: reduce){
      body::before, body::after{animation:none}
    }

    /* Card + form */
    .card{
      width:100%;max-width:560px;background:var(--panel);
      border:1px solid var(--border);border-radius:16px;
      padding:28px 28px 22px;box-shadow:0 10px 30px rgba(0,0,0,.3);
      position:relative;z-index:1;
    }
    h1{margin:0 0 .25rem 0;font-size:1.6rem}
    .lead{margin:0 0 1rem 0;color:var(--sub)}
    #joinCount{color:var(--accent);font-weight:700;margin:.25rem 0 1rem}

    label{display:block;font-weight:600;margin:.5rem 0 .25rem}
    input[type=email]{
      width:100%;padding:12px 14px;border-radius:10px;
      border:1px solid var(--border);background:#0b1017;color:var(--text);outline:none
    }
    input[type=email]:focus{border-color:var(--focus);box-shadow:0 0 0 3px rgba(27,154,170,.25)}
    .row{margin:12px 0}
    .gcap{margin:10px 0 12px}
    .hint{color:var(--sub);font-size:.9rem}

    button{
      appearance:none;border:0;border-radius:10px;padding:12px 16px;
      background:var(--accent);color:#00100e;font-weight:700;cursor:pointer;width:100%;
      transition:transform .08s ease, filter .15s ease
    }
    button:hover{filter:brightness(1.05)}
    button:active{transform:translateY(1px)}
    .pulse{animation:pulse .9s ease-in-out 1}
    @keyframes pulse{50%{transform:scale(1.02)}}

    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
  </style>
</head>
<body>
  <main class="card" role="main">
    <h1>Join the BlackGrid Digest</h1>
    <p class="lead">Weekly intel. No spam. Unsubscribe anytime.</p>
    <div id="joinCount" aria-live="polite"></div>

    <form name="digest" method="POST" netlify netlify-honeypot="bot-field"
          data-netlify-recaptcha="true" accept-charset="UTF-8" action="/thanks.html">
      <input type="hidden" name="form-name" value="digest">

      <!-- honeypot -->
      <p class="sr-only"><label>Leave this empty:
        <input type="text" name="bot-field" autocomplete="off"></label></p>

      <!-- UTM + referrer capture -->
      <input type="hidden" name="utm_source">
      <input type="hidden" name="utm_medium">
      <input type="hidden" name="utm_campaign">
      <input type="hidden" name="utm_term">
      <input type="hidden" name="utm_content">
      <input type="hidden" name="referrer">
      <input type="hidden" name="page">

      <div class="row">
        <label for="email">Email</label>
        <input id="email" name="email" type="email" required autocomplete="email" placeholder="you@company.com">
      </div>

      <div class="gcap" data-netlify-recaptcha="true"></div>

      <button id="submitBtn" type="submit">Join digest</button>
      <p class="hint">We’ll never share your email.</p>
    </form>
  </main>

  <script>
    // Micro-interaction: subtle state on submit (doesn't block Netlify)
    const form = document.forms.digest;
    const btn = document.getElementById('submitBtn');
    form.addEventListener('submit', () => {
      btn.classList.add('pulse');
      btn.disabled = true;
      btn.textContent = 'Encrypting…';
      setTimeout(() => btn.textContent = 'Sending…', 300);
    });

    // UTM + referrer capture
    (function(){
      const params = new URLSearchParams(location.search);
      const set = (k) => { const el=form.querySelector(`[name="${k}"]`); if(el) el.value = params.get(k) || ''; };
      ['utm_source','utm_medium','utm_campaign','utm_term','utm_content'].forEach(set);
      const ref = form.querySelector('[name="referrer"]'); if(ref) ref.value = document.referrer || '';
      const pg = form.querySelector('[name="page"]'); if(pg) pg.value = location.href;
    })();

    // Live join count (serverless function)
    fetch('/.netlify/functions/join-count').then(r=>r.json()).then(({count})=>{
      if(typeof count === 'number'){
        const el = document.getElementById('joinCount');
        el.textContent = new Intl.NumberFormat().format(count) + ' joined';
      }
    }).catch(()=>{});
  </script>
</body>
</html>
